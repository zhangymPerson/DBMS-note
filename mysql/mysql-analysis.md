# mysql事务分析

- 事务的四大特性：ACID

    原子性（Atomicity，或称不可分割性）
    
    一致性（Consistency）
    
    隔离性（Isolation，又称独立性）
    
    持久性（Durability）。

    - 原子性：一个事务（transaction）中的所有操作，要么全部完成，要么全部不完成，不会结束在中间某个环节。事务在执行过程中发生错误，会被回滚（Rollback）到事务开始前的状态，就像这个事务从来没有执行过一样。

    - 一致性：在事务开始之前和事务结束以后，数据库的完整性没有被破坏。这表示写入的资料必须完全符合所有的预设规则，这包含资料的精确度、串联性以及后续数据库可以自发性地完成预定的工作。

    - 隔离性：数据库允许多个并发事务同时对其数据进行读写和修改的能力，隔离性可以防止多个事务并发执行时由于交叉执行而导致数据的不一致。事务隔离分为不同级别，包括读未提交（Read uncommitted）、读提交（read committed）、可重复读（repeatable read）和串行化（Serializable）。

    - 持久性：事务处理结束后，对数据的修改就是永久的，即便系统故障也不会丢失。




- 事务出现的问题
    事务并发问题| 描述
    |-|-|
    |脏读|事务A读取了事务B更新的数据，然后B回滚操作，那么A读取到的数据是脏数据
    |不可重复读|事务 A 多次读取同一数据，事务 B 在事务A多次读取的过程中，对数据作了更新并提交，导致事务A多次读取同一数据时，结果 不一致。
    |幻读|系统管理员A将数据库中所有学生的成绩从具体分数改为ABCDE等级，但是系统管理员B就在这个时候插入了一条具体分数的记录，当系统管理员A改结束后发现还有一条记录没有改过来，就好像发生了幻觉一样，这就叫幻读。
 小结：不可重复读的和幻读很容易混淆，**不可重复读侧重于修改**，**幻读侧重于新增或删除**。解决不可重复读的问题只需锁住满足条件的行，解决幻读需要锁表

- 事务的四种隔离级别
    |事务隔离级别	|脏读	|不可重复读	|幻读|
    |-|-|-|-|
    |读未提交（read-uncommitted） |是	|是	|是
    |不可重复读（read-committed） |否	|是	|是
    |可重复读（repeatable-read）  |否	|否	|是
    |串行化（serializable）	      |否	|否	|否


- 与事务相关的sql

```sql
-- 查看mysql的建表语句
show create table table_name;

-- 可以查看建表语句，表引擎；

-- 查看mysql事务级别

select @@tx_isolation;

-- 配置当前session的事务隔离级别

set session transaction isolation level read committed;

-- 查看mysql是否开启自动提交
show VARIABLES like 'autocommit';

```